<Window x:Class="XB2Midi.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:views="clr-namespace:XB2Midi.Views"
        xmlns:converters="clr-namespace:XB2Midi.Converters"
        Title="XB2Midi" Height="800" Width="1000">
    <Window.Resources>
        <converters:MidiTypeToEnabledConverter x:Key="MidiTypeToEnabledConverter"/>
    </Window.Resources>
    <Grid>
        <TabControl>
            <!-- Commented out Devices tab
            <TabItem Header="Devices">
                <Grid>
                    <StackPanel Margin="10">
                        <GroupBox Header="MIDI Output Devices" Margin="0,0,0,10">
                            <StackPanel Margin="10">
                                <StackPanel Orientation="Horizontal" Margin="0,10,0,10">
                                    <ComboBox x:Name="GlobalDeviceComboBox" Width="300" Margin="0,0,10,0"/>
                                    <Button Content="Refresh" Click="RefreshDevicesButton_Click" Width="100"/>
                                    <Button Content="Test Note" Click="TestNoteButton_Click" Width="100" Margin="10,0,0,0"/>
                                </StackPanel>
                                <TextBlock x:Name="ModeDisplay" Text="Mode: Basic" FontWeight="Bold" Margin="0,10,0,0"/>
                            </StackPanel>
                        </GroupBox>
                        
                        <GroupBox Header="Controller Status">
                            <TextBlock x:Name="ControllerStatus" Text="Controller: Disconnected" Padding="10"/>
                        </GroupBox>
                        
                        <GroupBox Header="MIDI Activity">
                            <ListBox x:Name="MidiActivityLog" Height="200" Margin="10"/>
                        </GroupBox>
                    </StackPanel>
                </Grid>
            </TabItem>
            -->
            
            <!-- Basic Mode Mapping Tab -->
            <TabItem Header="Basic Mode Mapping" x:Name="BasicMappingTab">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/> <!-- Header -->
                        <RowDefinition Height="Auto"/> <!-- Mapping Controls & Buttons -->
                        <RowDefinition Height="*"/>     <!-- Mappings List and MIDI Activity -->
                    </Grid.RowDefinitions>
                    
                    <!-- Header -->
                    <TextBlock Grid.Row="0" Text="Map controller inputs to MIDI messages" 
                             FontWeight="Bold" Margin="0,0,0,10"/>
                    
                    <!-- Mapping configuration area and Actions side-by-side -->
                    <Grid Grid.Row="1">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="2*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <!-- Define New Mapping section - Left -->
                        <GroupBox Grid.Column="0" Header="Define New Mapping" Margin="0,0,5,10">
                            <Grid Margin="10">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Controller Input:" VerticalAlignment="Center" Margin="0,0,10,10"/>
                                <ComboBox Grid.Row="0" Grid.Column="1" x:Name="ControllerInputComboBox" Margin="0,0,0,10"/>
                                
                                <TextBlock Grid.Row="1" Grid.Column="0" Text="MIDI Message Type:" VerticalAlignment="Center" Margin="0,0,10,10"/>
                                <ComboBox Grid.Row="1" Grid.Column="1" x:Name="MidiTypeComboBox" Margin="0,0,0,10" 
                                         SelectionChanged="MidiTypeComboBox_SelectionChanged">
                                    <ComboBoxItem Content="Note" IsSelected="True"/>
                                    <ComboBoxItem Content="Control Change"/>
                                    <ComboBoxItem Content="Pitch Bend"/>
                                </ComboBox>
                                
                                <TextBlock Grid.Row="2" Grid.Column="0" Text="MIDI Device:" VerticalAlignment="Center" Margin="0,0,10,10"/>
                                <ComboBox Grid.Row="2" Grid.Column="1" x:Name="BasicMappingDeviceComboBox" Margin="0,0,0,10"/>
                                
                                <TextBlock Grid.Row="3" Grid.Column="0" Text="MIDI Channel (1-16):" VerticalAlignment="Center" Margin="0,0,10,10"/>
                                <TextBox Grid.Row="3" Grid.Column="1" x:Name="MidiChannelTextBox" Margin="0,0,0,10" Text="1"/>
                                
                                <TextBlock Grid.Row="4" Grid.Column="0" Text="MIDI Value (0-127):" VerticalAlignment="Center" Margin="0,0,10,10"/>
                                <TextBox Grid.Row="4" Grid.Column="1" x:Name="MidiValueTextBox" Margin="0,0,0,10"/>
                            </Grid>
                        </GroupBox>
                        
                        <!-- Actions section - Right, with 2-column button layout -->
                        <GroupBox Grid.Column="1" Header="Actions" Margin="5,0,0,10">
                            <Grid Margin="10">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <!-- Row 1: Add Mapping and Refresh Devices -->
                                <Button Grid.Row="0" Grid.Column="0" Content="Add Mapping" Click="AddMapping_Click" 
                                       Margin="0,0,5,5" Padding="5,8" FontWeight="Bold" />
                                <Button Grid.Row="0" Grid.Column="1" Content="Refresh Devices" Click="RefreshDevicesButton_Click" 
                                       Margin="5,0,0,5" Padding="5,8" />
                                
                                <!-- Row 2: Save Mappings and Load Mappings -->
                                <Button Grid.Row="1" Grid.Column="0" Content="Save Mappings" Click="SaveMappings_Click" 
                                       Margin="0,5,5,5" Padding="5,8" />
                                <Button Grid.Row="1" Grid.Column="1" Content="Load Mappings" Click="LoadMappings_Click" 
                                       Margin="5,5,0,5" Padding="5,8" />
                                
                                <!-- Row 3: Delete Selected -->
                                <Button Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2" Content="Delete Selected" Click="DeleteMapping_Click" 
                                       Margin="0,5,0,0" Padding="5,8" />
                            </Grid>
                        </GroupBox>
                    </Grid>
                    
                    <!-- Mappings List and MIDI Activity in two columns with GroupBoxes -->
                    <Grid Grid.Row="2">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <!-- Mappings List Section -->
                        <GroupBox Grid.Column="0" Header="Current Mappings" Margin="0,0,5,0">
                            <ListView x:Name="MappingsListView" Margin="10">
                                <ListView.View>
                                    <GridView>
                                        <GridViewColumn Header="Controller Input" Width="100" DisplayMemberBinding="{Binding ControllerInput}"/>
                                        <GridViewColumn Header="Message Type" Width="100" DisplayMemberBinding="{Binding MessageType}"/>
                                        <GridViewColumn Header="Device" Width="80" DisplayMemberBinding="{Binding MidiDeviceIndex}"/>
                                        <GridViewColumn Header="Ch" Width="30" DisplayMemberBinding="{Binding DisplayChannel}"/>
                                        <GridViewColumn Header="Value" Width="40" DisplayMemberBinding="{Binding DisplayValue}"/>
                                    </GridView>
                                </ListView.View>
                            </ListView>
                        </GroupBox>
                        
                        <!-- MIDI Activity Column -->
                        <GroupBox Grid.Column="1" Header="MIDI Activity" Margin="5,0,0,0">
                            <ListBox x:Name="MidiActivityLog" Margin="10"/>
                        </GroupBox>
                    </Grid>
                </Grid>
            </TabItem>
            
            <!-- Chord Mode Mapping Tab -->
            <TabItem x:Name="ChordMappingTab" Header="Chord">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Header with instructions -->
                    <Border Grid.Row="0" Background="#F0F0F0" Padding="10" Margin="0,0,0,10">
                        <TextBlock TextWrapping="Wrap">
                            <Bold>Chord Mode:</Bold> Play roots, chords, and extensions using the controller.
                        </TextBlock>
                    </Border>
                    
                    <!-- Main content area -->
                    <Grid Grid.Row="1">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <!-- Left column - Controller mapping visualization -->
                        <Border Grid.Column="0" BorderThickness="1" BorderBrush="#CCCCCC" Margin="5" Padding="10">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                                                
                                <Grid Grid.Row="1">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    
                                    <!-- Face Buttons -->
                                    <GroupBox Grid.Row="0" Header="Face Buttons" Margin="0,5">
                                        <Grid Margin="5">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>
                                            
                                            <!-- Header row -->
                                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Button" FontWeight="Bold" Margin="5"/>
                                            <TextBlock Grid.Row="0" Grid.Column="1" Text="Note" FontWeight="Bold" Margin="5"/>
                                            <TextBlock Grid.Row="0" Grid.Column="2" Text="Channel" FontWeight="Bold" Margin="5"/>
                                            <TextBlock Grid.Row="0" Grid.Column="3" Text="Device" FontWeight="Bold" Margin="5"/>
                                            
                                            <!-- Y Button -->
                                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Y:" Margin="5"/>
                                            <ComboBox Grid.Row="1" Grid.Column="1" x:Name="YButtonNoteCombo" Margin="5"/>
                                            <ComboBox Grid.Row="1" Grid.Column="2" x:Name="YChannelCombo" Margin="5" Width="60"/>
                                            <ComboBox Grid.Row="1" Grid.Column="3" x:Name="YDeviceCombo" Margin="5" Width="120"/>
                                            
                                            <!-- B Button -->
                                            <TextBlock Grid.Row="2" Grid.Column="0" Text="B:" Margin="5"/>
                                            <ComboBox Grid.Row="2" Grid.Column="1" x:Name="BButtonNoteCombo" Margin="5"/>
                                            <ComboBox Grid.Row="2" Grid.Column="2" x:Name="BChannelCombo" Margin="5" Width="60"/>
                                            <ComboBox Grid.Row="2" Grid.Column="3" x:Name="BDeviceCombo" Margin="5" Width="120"/>
                                            
                                            <!-- X Button -->
                                            <TextBlock Grid.Row="3" Grid.Column="0" Text="X:" Margin="5"/>
                                            <ComboBox Grid.Row="3" Grid.Column="1" x:Name="XButtonNoteCombo" Margin="5"/>
                                            <ComboBox Grid.Row="3" Grid.Column="2" x:Name="XChannelCombo" Margin="5" Width="60"/>
                                            <ComboBox Grid.Row="3" Grid.Column="3" x:Name="XDeviceCombo" Margin="5" Width="120"/>
                                            
                                            <!-- A Button -->
                                            <TextBlock Grid.Row="4" Grid.Column="0" Text="A:" Margin="5"/>
                                            <ComboBox Grid.Row="4" Grid.Column="1" x:Name="AButtonNoteCombo" Margin="5"/>
                                            <ComboBox Grid.Row="4" Grid.Column="2" x:Name="AChannelCombo" Margin="5" Width="60"/>
                                            <ComboBox Grid.Row="4" Grid.Column="3" x:Name="ADeviceCombo" Margin="5" Width="120"/>
                                        </Grid>
                                    </GroupBox>
                                    
                                    <!-- D-Pad -->
                                    <GroupBox Grid.Row="1" Header="D-Pad" Margin="0,5">
                                        <Grid Margin="5">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>
                                            
                                            <!-- Header row -->
                                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Button" FontWeight="Bold" Margin="5"/>
                                            <TextBlock Grid.Row="0" Grid.Column="1" Text="Note" FontWeight="Bold" Margin="5"/>
                                            <TextBlock Grid.Row="0" Grid.Column="2" Text="Channel" FontWeight="Bold" Margin="5"/>
                                            <TextBlock Grid.Row="0" Grid.Column="3" Text="Device" FontWeight="Bold" Margin="5"/>
                                            
                                            <!-- DPad Up -->
                                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Up:" Margin="5"/>
                                            <ComboBox Grid.Row="1" Grid.Column="1" x:Name="DPadUpNoteCombo" Margin="5"/>
                                            <ComboBox Grid.Row="1" Grid.Column="2" x:Name="DPadUpChannelCombo" Margin="5" Width="60"/>
                                            <ComboBox Grid.Row="1" Grid.Column="3" x:Name="DPadUpDeviceCombo" Margin="5" Width="120"/>
                                            
                                            <!-- DPad Right -->
                                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Right:" Margin="5"/>
                                            <ComboBox Grid.Row="2" Grid.Column="1" x:Name="DPadRightNoteCombo" Margin="5"/>
                                            <ComboBox Grid.Row="2" Grid.Column="2" x:Name="DPadRightChannelCombo" Margin="5" Width="60"/>
                                            <ComboBox Grid.Row="2" Grid.Column="3" x:Name="DPadRightDeviceCombo" Margin="5" Width="120"/>
                                            
                                            <!-- DPad Down -->
                                            <TextBlock Grid.Row="3" Grid.Column="0" Text="Down:" Margin="5"/>
                                            <ComboBox Grid.Row="3" Grid.Column="1" x:Name="DPadDownNoteCombo" Margin="5"/>
                                            <ComboBox Grid.Row="3" Grid.Column="2" x:Name="DPadDownChannelCombo" Margin="5" Width="60"/>
                                            <ComboBox Grid.Row="3" Grid.Column="3" x:Name="DPadDownDeviceCombo" Margin="5" Width="120"/>
                                            
                                            <!-- DPad Left -->
                                            <TextBlock Grid.Row="4" Grid.Column="0" Text="Left:" Margin="5"/>
                                            <ComboBox Grid.Row="4" Grid.Column="1" x:Name="DPadLeftNoteCombo" Margin="5"/>
                                            <ComboBox Grid.Row="4" Grid.Column="2" x:Name="DPadLeftChannelCombo" Margin="5" Width="60"/>
                                            <ComboBox Grid.Row="4" Grid.Column="3" x:Name="DPadLeftDeviceCombo" Margin="5" Width="120"/>
                                        </Grid>
                                    </GroupBox>
                                    
                                    <!-- Test Section - Moved from right column -->
                                    <GroupBox Grid.Row="2" Header="Test Chord" Margin="0,5">
                                        <Grid Margin="5">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Root Note:" Margin="5" VerticalAlignment="Center"/>
                                            <ComboBox Grid.Row="0" Grid.Column="1" x:Name="TestChordRootCombo" Margin="5"/>
                                            <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" Orientation="Horizontal" Margin="5" HorizontalAlignment="Center">
                                                <Button Content="Major" x:Name="TestMajorButton" Margin="5" Padding="5,3" Click="TestMajorChord_Click"/>
                                                <Button Content="Minor" x:Name="TestMinorButton" Margin="5" Padding="5,3" Click="TestMinorChord_Click"/>
                                                <Button Content="Maj7" x:Name="TestMajor7Button" Margin="5" Padding="5,3" Click="TestMajor7Chord_Click"/>
                                                <Button Content="Min7" x:Name="TestMinor7Button" Margin="5" Padding="5,3" Click="TestMinor7Chord_Click"/>
                                                <Button Content="Maj9" x:Name="TestMajor9Button" Margin="5" Padding="5,3" Click="TestMajor9Chord_Click"/>
                                                <Button Content="Min9" x:Name="TestMinor9Button" Margin="5" Padding="5,3" Click="TestMinor9Chord_Click"/>
                                                <Button Content="Dom7" x:Name="Test7thButton" Margin="5" Padding="5,3" Click="Test7thChord_Click"/>
                                                <Button Content="Dim" x:Name="TestDimButton" Margin="5" Padding="5,3" Click="TestDimChord_Click"/>
                                            </StackPanel>
                                        </Grid>
                                    </GroupBox>
                                </Grid>
                            </Grid>
                        </Border>
                        
                        <!-- Right column - Chord reference and log -->
                        <Border Grid.Column="1" BorderThickness="1" BorderBrush="#CCCCCC" Margin="5" Padding="10">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                
                                <!-- Chord Type Reference - Moved from left column -->
                                <GroupBox Grid.Row="0" Header="Chord Type Reference" Margin="0,5">
                                    <Grid Margin="5">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                            
                                        <TextBlock Grid.Row="0" Grid.Column="0" Text="No Bumpers:" Margin="5" FontWeight="Bold"/>
                                        <TextBlock Grid.Row="0" Grid.Column="1" Text="Root Note Only" Margin="5"/>
                                        
                                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Left Bumper (LB):" Margin="5" FontWeight="Bold"/>
                                        <TextBlock Grid.Row="1" Grid.Column="1" Text="Minor Triad (1-b3-5)" Margin="5"/>
                                        
                                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Right Bumper (RB):" Margin="5" FontWeight="Bold"/>
                                        <TextBlock Grid.Row="2" Grid.Column="1" Text="Major Triad (1-3-5)" Margin="5"/>
                                        
                                        <TextBlock Grid.Row="3" Grid.Column="0" Text="Double-Tap LB:" Margin="5" FontWeight="Bold"/>
                                        <TextBlock Grid.Row="3" Grid.Column="1" Text="Minor 7th Chord (1-b3-5-b7)" Margin="5"/>
                                        
                                        <TextBlock Grid.Row="4" Grid.Column="0" Text="Double-Tap RB:" Margin="5" FontWeight="Bold"/>
                                        <TextBlock Grid.Row="4" Grid.Column="1" Text="Major 7th Chord (1-3-5-7)" Margin="5"/>
                                        
                                        <TextBlock Grid.Row="5" Grid.Column="0" Text="Triple-Tap LB:" Margin="5" FontWeight="Bold"/>
                                        <TextBlock Grid.Row="5" Grid.Column="1" Text="Minor 9th Chord (1-b3-5-b7-9)" Margin="5"/>
                                        
                                        <TextBlock Grid.Row="6" Grid.Column="0" Text="Triple-Tap RB:" Margin="5" FontWeight="Bold"/>
                                        <TextBlock Grid.Row="6" Grid.Column="1" Text="Major 9th Chord (1-3-5-7-9)" Margin="5"/>
                                        
                                        <TextBlock Grid.Row="7" Grid.Column="0" Text="Both Bumpers:" Margin="5" FontWeight="Bold"/>
                                        <TextBlock Grid.Row="7" Grid.Column="1" Text="Dominant 7th (1-3-5-b7)" Margin="5"/>
                                    </Grid>
                                </GroupBox>
                                
                                <!-- Log Section -->
                                <GroupBox Grid.Row="1" Header="Chord Activity" Margin="0,5">
                                    <ListBox x:Name="ChordActivityLog" Margin="5"/>
                                </GroupBox>
                            </Grid>
                        </Border>
                    </Grid>
                    
                    <!-- Footer buttons -->
                    <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="5">
                        <Button Content="Reset to Defaults" x:Name="ResetChordMappingsButton" Margin="5" Padding="10,5" Click="ResetChordMappings_Click"/>
                        <Button Content="Load Mappings" x:Name="LoadChordMappingsButton" Margin="5" Padding="10,5" Click="LoadChordMappings_Click"/>
                        <Button Content="Save Mappings" x:Name="SaveChordMappingsButton" Margin="5" Padding="10,5" Click="SaveChordMappings_Click"/>
                    </StackPanel>
                </Grid>
            </TabItem>
            
            <!-- Arpeggio Mode Mapping Tab -->
            <TabItem Header="Arpeggio Mode Mapping" x:Name="ArpeggioMappingTab">
                <Grid>
                    <TextBlock Text="Arpeggio Mode settings coming soon" 
                             FontWeight="Bold" HorizontalAlignment="Center"/>
                </Grid>
            </TabItem>
            
            <!-- Direct Mode Mapping Tab -->
            <TabItem Header="Direct Mode Mapping" x:Name="DirectMappingTab">
                <Grid>
                    <TextBlock Text="Direct mode mapping controls" 
                             FontWeight="Bold" HorizontalAlignment="Center"/>
                </Grid>
            </TabItem>
            
            <!-- Visualizer Tab -->
            <TabItem Header="Visualizer">
                <Grid>
                    <StackPanel>
                        <views:ControllerVisualizer x:Name="DebugVisualizer" Height="300"/>
                        <TextBlock x:Name="TestModeDisplay" Text="Mode: Basic" FontWeight="Bold" 
                                 Margin="10" HorizontalAlignment="Center"/>
                    </StackPanel>
                </Grid>
            </TabItem>
            
            <!-- Test Tab -->
            <TabItem Header="Test">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <StackPanel Grid.Row="0" Margin="10">
                        <views:InteractiveControllerVisualizer x:Name="TestVisualizer" Height="300"/>
                        <Slider x:Name="SpringBackRateSlider" Minimum="0.001" Maximum="0.1" Value="0.05"
                               ValueChanged="SpringBackRateSlider_ValueChanged"
                               TickFrequency="0.01" TickPlacement="BottomRight" IsSnapToTickEnabled="True"/>
                        <TextBlock Text="Spring-back rate:" Margin="0,5,0,0"/>
                        <Slider x:Name="TriggerRateSlider" Minimum="1" Maximum="20" Value="10"
                               ValueChanged="TriggerRateSlider_ValueChanged"
                               TickFrequency="1" TickPlacement="BottomRight" IsSnapToTickEnabled="True"/>
                        <TextBlock Text="Trigger rate:" Margin="0,5,0,0"/>
                    </StackPanel>
                    
                    <Grid Grid.Row="1" Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <TextBlock Text="Test Results:" Grid.Row="0" FontWeight="Bold"/>
                        <ListBox x:Name="TestResultsLog" Grid.Row="1" Margin="0,5,0,0"/>
                    </Grid>
                </Grid>
            </TabItem>
            
            <!-- Log Tab -->
            <TabItem Header="Log">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <StackPanel Grid.Row="0" Orientation="Horizontal">
                        <Button Content="Clear Log" Click="ClearLog_Click" Margin="0,0,10,0"/>
                    </StackPanel>
                    <ListBox x:Name="InputLog" Grid.Row="1" Margin="0,10,0,0" 
                            KeyDown="InputLog_KeyDown"/>
                </Grid>
            </TabItem>
        </TabControl>
    </Grid>
</Window>