<Window x:Class="XB2Midi.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:views="clr-namespace:XB2Midi.Views"
        xmlns:converters="clr-namespace:XB2Midi.Converters"
        Title="XB2Midi" Height="800" Width="1000">
    <Window.Resources>
        <converters:MidiTypeToEnabledConverter x:Key="MidiTypeToEnabledConverter"/>
    </Window.Resources>
    <Grid>
        <TabControl>
           <!-- <TabItem Header="Device Setup">
                <Grid Margin="10">
                    <GroupBox Header="MIDI Control Panel">
                        <StackPanel Margin="10">
                            <TextBlock Text="MIDI Output Device:"/>
                            <ComboBox x:Name="MidiDeviceComboBox" 
                                    SelectionChanged="MidiDeviceComboBox_SelectionChanged"
                                    Margin="0,5,0,5"/>
                            <Button x:Name="RefreshDevicesButton" 
                                    Content="Refresh Devices"
                                    Click="RefreshDevicesButton_Click"
                                    Margin="0,0,0,10"/>
                            <TextBlock Margin="0,10,0,0">
                                <Run Text="Connection Status: "/>
                                <Run x:Name="ConnectionStatus" Text="Not Connected"/>
                            </TextBlock>
                        </StackPanel>
                    </GroupBox>
                </Grid>
            </TabItem> -->

            <TabItem Header="Mapping">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Mapping Controls -->
                    <GroupBox Header="Add New Mapping" Grid.Row="0">
                        <Grid Margin="5">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>  <!-- Modified to accommodate device dropdown -->
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <!-- Labels -->
                            <TextBlock Text="Controller Input" Grid.Column="0" Margin="2,0,2,2"/>
                            <TextBlock Text="MIDI Message Type" Grid.Column="1" Margin="2,0,2,2"/>
                            <TextBlock Text="MIDI Device" Grid.Column="2" Margin="2,0,2,2"/>
                            <TextBlock Text="Channel" Grid.Column="3" Margin="2,0,2,2"/>
                            <TextBlock Text="Value" Grid.Column="4" Margin="2,0,2,2"/>

                            <!-- Input Controls -->
                            <ComboBox x:Name="ControllerInputComboBox" Grid.Row="1" Grid.Column="0" Margin="2">
                                <ComboBoxItem Content="A"/>
                                <ComboBoxItem Content="B"/>
                                <ComboBoxItem Content="X"/>
                                <ComboBoxItem Content="Y"/>
                                <ComboBoxItem Content="LeftThumbClick"/>
                                <ComboBoxItem Content="RightThumbClick"/>
                                <ComboBoxItem Content="Back"/>
                                <ComboBoxItem Content="Start"/>
                                <ComboBoxItem Content="DPadUp"/>
                                <ComboBoxItem Content="DPadDown"/>
                                <ComboBoxItem Content="DPadLeft"/>
                                <ComboBoxItem Content="DPadRight"/>
                                <ComboBoxItem Content="LeftBumper"/>
                                <ComboBoxItem Content="RightBumper"/>
                                <ComboBoxItem Content="LeftTrigger"/>
                                <ComboBoxItem Content="RightTrigger"/>
                                <ComboBoxItem Content="LeftThumbstickX"/>
                                <ComboBoxItem Content="LeftThumbstickY"/>
                                <ComboBoxItem Content="RightThumbstickX"/>
                                <ComboBoxItem Content="RightThumbstickY"/>
                            </ComboBox>

                            <ComboBox x:Name="MidiTypeComboBox" Grid.Row="1" Grid.Column="1" Margin="2" SelectedIndex="0" SelectionChanged="MidiTypeComboBox_SelectionChanged">
                                <ComboBoxItem Content="Note"/>
                                <ComboBoxItem Content="Control Change"/>
                                <ComboBoxItem Content="Pitch Bend"/>
                            </ComboBox>

                            <!-- Add MIDI Device ComboBox -->
                            <ComboBox x:Name="MappingDeviceComboBox" 
                                      Grid.Row="1" 
                                      Grid.Column="2" 
                                      Margin="2"/>

                            <TextBox x:Name="MidiChannelTextBox" Grid.Row="1" Grid.Column="3" 
                                     Width="40" Margin="2"
                                     ToolTip="MIDI Channel (1-16)"/>

                            <TextBox x:Name="MidiValueTextBox" Grid.Row="1" Grid.Column="4" 
                                     Width="50" Margin="2"
                                     ToolTip="Note/CC number (0-127)"      
                                     IsEnabled="{Binding ElementName=MidiTypeComboBox, 
                                                       Path=SelectedItem.Content, 
                                                       Converter={StaticResource MidiTypeToEnabledConverter}}"/>

                            <Button Grid.Row="2" Grid.ColumnSpan="5" 
                                    Content="Add Mapping"      
                                    Click="AddMapping_Click"
                                    Margin="2,5,2,2"/>
                        </Grid>
                    </GroupBox>

                    <!-- Combined Mappings and Activity Log -->
                    <GroupBox Header="Mappings and Activity" Grid.Row="1" Margin="0,5,0,5">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Current Mappings -->
                            <GroupBox Header="Current Mappings" 
                                     Grid.Column="0" 
                                     Margin="0,0,5,0">
                                <views:MappingsView x:Name="MappingsView"/>
                            </GroupBox>

                            <!-- Activity Log -->
                            <GroupBox Header="MIDI Activity" 
                                     Grid.Column="1" 
                                     Margin="5,0,0,0">
                                <ListBox x:Name="MidiActivityLog" 
                                        ScrollViewer.VerticalScrollBarVisibility="Auto">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding}"/>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                            </GroupBox>
                        </Grid>
                    </GroupBox>

                    <!-- Mapping Log -->
                    <ListView x:Name="MappingLog" 
                              Grid.Row="1" 
                              Height="200" 
                              VerticalAlignment="Bottom"
                              ItemsSource="{Binding midiLog}"/>

                    <!-- Last Message -->
                    <!-- <TextBlock Grid.Row="2" Margin="5">
                        <Run Text="Last MIDI Message: "/>
                        <Run x:Name="LastMidiMessage" Text="None"/>
                    </TextBlock> -->
                </Grid>
            </TabItem>

            <!-- Replace the Controller Debug Tab content -->
            <TabItem Header="Controller Debug">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="2*"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Controller Visualizer with Status -->
                    <Border Grid.Row="0" Margin="0,0,0,10">
                        <Grid>
                            <!-- Controller Visualizer -->
                            <views:ControllerVisualizer x:Name="DebugVisualizer"/>
                            
                            <!-- Centered Status Label -->
                            <TextBlock x:Name="ControllerStatus" 
                                      Text="Controller Disconnected" 
                                      Foreground="Red"
                                      FontWeight="Bold"
                                      HorizontalAlignment="Center"
                                      VerticalAlignment="Top"
                                      Margin="0,10,0,0"/>
                        </Grid>
                    </Border>

                    <!-- Debug Section with Controls Column -->
                    <Grid Grid.Row="1">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Debug Controls Column -->
                        <GroupBox Header="Controls" 
                                 Grid.Column="0" 
                                 Margin="0,0,10,0"
                                 Width="120">
                            <StackPanel Margin="5">
                                <Button Content="Clear Log" 
                                        Click="ClearLog_Click"
                                        Margin="0,0,0,5"
                                        Padding="10,5"/>
                                <!-- Add future control buttons here -->
                            </StackPanel>
                        </GroupBox>

                        <!-- Debug Log -->
                        <GroupBox Header="Input Debug Log" Grid.Column="1">
                            <ListBox x:Name="InputLog" 
                                     Height="200" 
                                     Margin="5"
                                     ScrollViewer.VerticalScrollBarVisibility="Auto"
                                     SelectionMode="Extended"
                                     KeyDown="InputLog_KeyDown">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding}" 
                                                  TextWrapping="NoWrap" 
                                                  FontFamily="Consolas"/>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </GroupBox>
                    </Grid>
                </Grid>
            </TabItem>

            <!-- Test Tab -->
            <TabItem Header="Test">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="2*"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Replace Trigger Settings with Control Settings -->
                    <GroupBox Header="Control Settings" Grid.Row="0">
                        <Grid Margin="5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Trigger Rate Control -->
                            <StackPanel Grid.Column="0" Margin="5">
                                <TextBlock Text="Trigger Rate:" Margin="0,0,0,5"/>
                                <Slider x:Name="TriggerRateSlider" 
                                        Minimum="1" Maximum="10" Value="5"
                                        TickFrequency="1" IsSnapToTickEnabled="True"
                                        ValueChanged="TriggerRateSlider_ValueChanged"/>
                                <TextBlock Text="{Binding ElementName=TriggerRateSlider, Path=Value, StringFormat=N1}"
                                           HorizontalAlignment="Center"/>
                            </StackPanel>

                            <!-- Spring-back Rate Control -->
                            <StackPanel Grid.Column="1" Margin="5">
                                <TextBlock Text="Spring-back Rate:" Margin="0,0,0,5"/>
                                <Slider x:Name="SpringBackRateSlider"
                                        Minimum="0.001"
                                        Maximum="0.5"
                                        Value="0.05"
                                        SmallChange="0.01"
                                        LargeChange="0.1"
                                        ValueChanged="SpringBackRateSlider_ValueChanged"/>
                                <TextBlock Text="{Binding ElementName=SpringBackRateSlider, Path=Value, StringFormat=N3}"
                                           HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Grid>
                    </GroupBox>
                    
                    <!-- Interactive Controller -->
                    <Border Grid.Row="1" Margin="0,10">
                        <views:InteractiveControllerVisualizer x:Name="TestVisualizer"/>
                    </Border>
                    
                    <!-- Test Results/Log -->
                    <GroupBox Header="Test Results" Grid.Row="2">
                        <ListBox x:Name="TestResultsLog"/>
                    </GroupBox>
                </Grid>
            </TabItem>
        </TabControl>
    </Grid>
</Window>