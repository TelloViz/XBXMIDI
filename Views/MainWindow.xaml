<Window x:Class="XB2Midi.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:views="clr-namespace:XB2Midi.Views"
        xmlns:converters="clr-namespace:XB2Midi.Converters"
        Title="XB2Midi" Height="800" Width="1000">
    <Window.Resources>
        <converters:MidiTypeToEnabledConverter x:Key="MidiTypeToEnabledConverter"/>
    </Window.Resources>
    <Grid>
        <TabControl>
            <TabItem Header="Devices">
                <Grid>
                    <StackPanel Margin="10">
                        <GroupBox Header="MIDI Output Devices" Margin="0,0,0,10">
                            <StackPanel Margin="10">
                                <StackPanel Orientation="Horizontal" Margin="0,10,0,10">
                                    <ComboBox x:Name="GlobalDeviceComboBox" Width="300" Margin="0,0,10,0"/>
                                    <Button Content="Refresh" Click="RefreshDevicesButton_Click" Width="100"/>
                                    <Button Content="Test Note" Click="TestNoteButton_Click" Width="100" Margin="10,0,0,0"/>
                                </StackPanel>
                                <TextBlock x:Name="ModeDisplay" Text="Mode: Basic" FontWeight="Bold" Margin="0,10,0,0"/>
                            </StackPanel>
                        </GroupBox>
                        
                        <GroupBox Header="Controller Status">
                            <TextBlock x:Name="ControllerStatus" Text="Controller: Disconnected" Padding="10"/>
                        </GroupBox>
                        
                        <GroupBox Header="MIDI Activity">
                            <ListBox x:Name="MidiActivityLog" Height="200" Margin="10"/>
                        </GroupBox>
                    </StackPanel>
                </Grid>
            </TabItem>
            
            <!-- Basic Mode Mapping Tab -->
            <TabItem Header="Basic Mode Mapping" x:Name="BasicMappingTab">
                <Grid>
                    <StackPanel Margin="10">
                        <TextBlock Text="Map controller inputs to MIDI messages" 
                                 FontWeight="Bold" Margin="0,0,0,10"/>
                        
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <TextBlock Text="Controller Input:" Grid.Row="0" Grid.Column="0" Margin="0,0,10,10"/>
                            <ComboBox x:Name="ControllerInputComboBox" Grid.Row="0" Grid.Column="1" Margin="0,0,0,10">
                                <!-- Controller inputs -->
                            </ComboBox>
                            
                            <TextBlock Text="MIDI Message Type:" Grid.Row="1" Grid.Column="0" Margin="0,0,10,10"/>
                            <ComboBox x:Name="MidiTypeComboBox" Grid.Row="1" Grid.Column="1" Margin="0,0,0,10" 
                                     SelectionChanged="MidiTypeComboBox_SelectionChanged">
                                <ComboBoxItem Content="Note" IsSelected="True"/>
                                <ComboBoxItem Content="Control Change"/>
                                <ComboBoxItem Content="Pitch Bend"/>
                            </ComboBox>
                            
                            <TextBlock Text="MIDI Device:" Grid.Row="2" Grid.Column="0" Margin="0,0,10,10"/>
                            <ComboBox x:Name="BasicMappingDeviceComboBox" Grid.Row="2" Grid.Column="1" Margin="0,0,0,10"/>
                            
                            <TextBlock Text="MIDI Channel (1-16):" Grid.Row="3" Grid.Column="0" Margin="0,0,10,10"/>
                            <TextBox x:Name="MidiChannelTextBox" Grid.Row="3" Grid.Column="1" Margin="0,0,0,10" Text="1"/>
                            
                            <TextBlock Text="MIDI Value (0-127):" Grid.Row="4" Grid.Column="0" Margin="0,0,10,10"/>
                            <TextBox x:Name="MidiValueTextBox" Grid.Row="4" Grid.Column="1" Margin="0,0,0,10"/>
                        </Grid>
                        
                        <StackPanel Orientation="Horizontal" Margin="0,10,0,20">
                            <Button Content="Add Mapping" Click="AddMapping_Click" Width="120"/>
                            <Button Content="Refresh Devices" Click="RefreshDevicesButton_Click" Margin="10,0,0,0" Width="120"/>
                        </StackPanel>

                        <!-- Mappings List -->
                        <TextBlock Text="Current Mappings:" FontWeight="Bold" Margin="0,0,0,5"/>
                        <ListView x:Name="MappingsListView" Height="200">
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn Header="Controller Input" Width="120" DisplayMemberBinding="{Binding ControllerInput}"/>
                                    <GridViewColumn Header="Message Type" Width="120" DisplayMemberBinding="{Binding MessageType}"/>
                                    <GridViewColumn Header="MIDI Device" Width="200" DisplayMemberBinding="{Binding MidiDeviceName}"/>
                                    <GridViewColumn Header="Channel" Width="60" DisplayMemberBinding="{Binding DisplayChannel}"/>
                                    <GridViewColumn Header="Value" Width="60" DisplayMemberBinding="{Binding DisplayValue}"/>
                                </GridView>
                            </ListView.View>
                        </ListView>
                        
                        <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                            <Button Content="Save Mappings" Click="SaveMappings_Click" Width="120"/>
                            <Button Content="Load Mappings" Click="LoadMappings_Click" Margin="10,0,0,0" Width="120"/>
                            <Button Content="Delete Selected" Click="DeleteMapping_Click" Margin="10,0,0,0" Width="120"/>
                        </StackPanel>
                    </StackPanel>
                </Grid>
            </TabItem>
            
            <!-- Chord Mode Mapping Tab -->
            <TabItem Header="Chord Mode Mapping" x:Name="ChordMappingTab">
                <Grid>
                    <StackPanel Margin="10">
                        <TextBlock Text="Chord Mode Controls" FontWeight="Bold" Margin="0,0,0,10"/>
                        <TextBlock TextWrapping="Wrap" Background="LightYellow" Padding="5">
                            <Run FontWeight="Bold">In Chord Mode:</Run>
                            <LineBreak/>
                            • Face buttons (A,B,X,Y) and D-pad trigger chord notes
                            <LineBreak/>
                            • Left Bumper: Minor chord modifier
                            <LineBreak/>
                            • Right Bumper: Dominant 7th modifier  
                            <LineBreak/>
                            • Both Bumpers: Diminished chord modifier
                        </TextBlock>
                        
                        <!-- Chord mode settings -->
                        <GroupBox Header="Chord Settings" Margin="0,10,0,0">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBlock Text="Root Note Octave:" Grid.Row="0" Grid.Column="0" Margin="5"/>
                                <Slider x:Name="RootOctaveSlider" Grid.Row="0" Grid.Column="1" 
                                       Minimum="2" Maximum="6" Value="4" IsSnapToTickEnabled="True" 
                                       TickFrequency="1" TickPlacement="BottomRight" Margin="5"/>
                                
                                <TextBlock Text="Velocity:" Grid.Row="1" Grid.Column="0" Margin="5"/>
                                <Slider x:Name="ChordVelocitySlider" Grid.Row="1" Grid.Column="1"
                                       Minimum="0" Maximum="127" Value="100" Margin="5"/>
                                       
                                <Button Content="Test Chord" Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2"
                                       Click="TestChord_Click" Margin="5"/>
                            </Grid>
                        </GroupBox>

                        <GroupBox Header="Button Note Assignments" Margin="0,10,0,0">
                            <!-- Note assignments for each button -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <TextBlock Text="Button A:" Grid.Row="0" Grid.Column="0" Margin="5"/>
                                <ComboBox x:Name="ButtonANoteCombo" Grid.Row="0" Grid.Column="1" Margin="5"/>
                            </Grid>
                        </GroupBox>
                    </StackPanel>
                </Grid>
            </TabItem>
            
            <!-- Arpeggio Mode Mapping Tab -->
            <TabItem Header="Arpeggio Mode Mapping" x:Name="ArpeggioMappingTab">
                <Grid>
                    <TextBlock Text="Arpeggio Mode settings coming soon" 
                             FontWeight="Bold" HorizontalAlignment="Center"/>
                </Grid>
            </TabItem>
            
            <!-- Direct Mode Mapping Tab -->
            <TabItem Header="Direct Mode Mapping" x:Name="DirectMappingTab">
                <Grid>
                    <TextBlock Text="Direct mode mapping controls" 
                             FontWeight="Bold" HorizontalAlignment="Center"/>
                </Grid>
            </TabItem>
            
            <!-- Visualizer Tab -->
            <TabItem Header="Visualizer">
                <Grid>
                    <StackPanel>
                        <views:ControllerVisualizer x:Name="DebugVisualizer" Height="300"/>
                        <TextBlock x:Name="TestModeDisplay" Text="Mode: Basic" FontWeight="Bold" 
                                 Margin="10" HorizontalAlignment="Center"/>
                    </StackPanel>
                </Grid>
            </TabItem>
            
            <!-- Test Tab -->
            <TabItem Header="Test">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <StackPanel Grid.Row="0" Margin="10">
                        <views:InteractiveControllerVisualizer x:Name="TestVisualizer" Height="300"/>
                        <Slider x:Name="SpringBackRateSlider" Minimum="0.001" Maximum="0.1" Value="0.05"
                               ValueChanged="SpringBackRateSlider_ValueChanged"
                               TickFrequency="0.01" TickPlacement="BottomRight" IsSnapToTickEnabled="True"/>
                        <TextBlock Text="Spring-back rate:" Margin="0,5,0,0"/>
                        
                        <Slider x:Name="TriggerRateSlider" Minimum="1" Maximum="20" Value="10"
                               ValueChanged="TriggerRateSlider_ValueChanged"
                               TickFrequency="1" TickPlacement="BottomRight" IsSnapToTickEnabled="True"/>
                        <TextBlock Text="Trigger rate:" Margin="0,5,0,0"/>
                    </StackPanel>
                    
                    <Grid Grid.Row="1" Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <TextBlock Text="Test Results:" Grid.Row="0" FontWeight="Bold"/>
                        <ListBox x:Name="TestResultsLog" Grid.Row="1" Margin="0,5,0,0"/>
                    </Grid>
                </Grid>
            </TabItem>
            
            <!-- Log Tab -->
            <TabItem Header="Log">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <StackPanel Grid.Row="0" Orientation="Horizontal">
                        <Button Content="Clear Log" Click="ClearLog_Click" Margin="0,0,10,0"/>
                    </StackPanel>
                    
                    <ListBox x:Name="InputLog" Grid.Row="1" Margin="0,10,0,0" 
                            KeyDown="InputLog_KeyDown"/>
                </Grid>
            </TabItem>
        </TabControl>
    </Grid>
</Window>